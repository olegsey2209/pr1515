<Page x:Class="WpfForrat15.Pages.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:WpfForrat15.Pages"
      mc:Ignorable="d" 
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
      DataContext="{Binding RelativeSource={RelativeSource Self}}"
      d:DesignHeight="700" d:DesignWidth="1000"
      Title="Каталог товаров"
      Background="{StaticResource PrimaryBackgroundColor}">

    <Page.Resources>
        <local:LessThanTenConverter x:Key="LessThanTenConverter"/>
    </Page.Resources>
    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="70"/>
            <RowDefinition/>
            <RowDefinition Height="30"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
            <Label>Поиск</Label>
            <TextBox Text="{Binding ProductService.SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                     TextChanged="TextBox_TextChanged"
                     materialDesign:HintAssist.Hint="Введите текст для поиска"/>
        </StackPanel>

        <StackPanel Grid.Row="1" Grid.Column="0">
            <Label>Сортировка</Label>
            <ComboBox x:Name="SortComboBox" SelectionChanged="ComboBox_SelectionChanged">
                <ComboBox.Items>
                    <ComboBoxItem Tag="Name">Название (А-Я)</ComboBoxItem>
                    <ComboBoxItem Tag="NameDesc">Название (Я-А)</ComboBoxItem>
                    <ComboBoxItem Tag="Price">Цена (по возрастанию)</ComboBoxItem>
                    <ComboBoxItem Tag="PriceDesc">Цена (по убыванию)</ComboBoxItem>
                    <ComboBoxItem Tag="Stock">Количество (по возрастанию)</ComboBoxItem>
                    <ComboBoxItem Tag="StockDesc">Количество (по убыванию)</ComboBoxItem>
                </ComboBox.Items>
            </ComboBox>

            <Label>Фильтры</Label>

            <StackPanel>
                <Label >Фильтр по категории</Label>
                <ComboBox x:Name="CategoryFilter" 
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id" 
                          SelectionChanged="FilterChanged">

                </ComboBox>
            </StackPanel>

            <StackPanel>
                <Label >Фильтр по бренду</Label>
                <ComboBox x:Name="BrandFilter" 
                          DisplayMemberPath="Name"
                          SelectedValuePath="Id" 
                          SelectionChanged="FilterChanged">

                </ComboBox>
            </StackPanel>

            <StackPanel>
                <Label >Фильтр по цене</Label>
                <Label>от</Label>
                <TextBox x:Name="PriceFromBox" 
                         TextChanged="PriceFilterChanged" 
                         materialDesign:HintAssist.Hint="Введите цену"/>
                <Label>до</Label>
                <TextBox x:Name="PriceToBox" 
                         TextChanged="PriceFilterChanged" 
                         materialDesign:HintAssist.Hint="Введите цену"/>
            </StackPanel>

            <Button  Click="ResetFilters">Сбросить фильтры</Button>


            <StackPanel Visibility="{Binding IsManagerMode, Converter={StaticResource BoolToVis}}">
                <Button Click="AddProduct">Добавить товар</Button>
                <Button Click="ManageBrands">Управление брендами</Button>
                <Button Click="ManageCategories">Управление категориями</Button>
                <Button Click="ManageTags">Управление тегами</Button>
                <Button Content="Удалить товар" 
        Click="DeleteProduct"
        Style="{StaticResource DangerRaisedButton}"
       />
            </StackPanel>

        </StackPanel>


        <materialDesign:ColorZone Grid.Row="1" Grid.Column="1" Mode="SecondaryMid">
            <ListView ItemsSource="{Binding ProductService.ProductsView}" 
                      x:Name="ProductsList" 
                      HorizontalContentAlignment="Stretch"
                      SelectionChanged="ProductsList_SelectionChanged"
                      MouseDoubleClick="EditProduct">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="10" Margin="2" Background="White" CornerRadius="5">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="BorderBrush" Value="LightGray"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Stock, Converter={StaticResource LessThanTenConverter}}"
                     Value="True">
                                            <Setter Property="BorderBrush" Value="{StaticResource WarningBorderColor}"/>
                                            <Setter Property="BorderThickness" Value="6"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>


                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Name}" 
                                              />
                                    <TextBlock>
                                        <Run Text="★"/>
                                        <Run Text="{Binding Rating, StringFormat={}{0:F1}}"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding Category.Name}"/>
                                    <TextBlock Text="{Binding Description}" 
                                               TextWrapping="Wrap" />
                                    <TextBlock Text="{Binding Tags}"/>

                                </StackPanel>


                                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                    <TextBlock Text="{Binding Price, StringFormat='{}{0:C}'}"
                                               />
                                    <TextBlock Text=" "/>
                                    <TextBlock Text=" "/>
                                    <TextBlock>
                                        <Run Text="Остаток: "/>
                                        <Run Text="{Binding Stock}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </materialDesign:ColorZone>

        <WrapPanel Grid.Row="2" Grid.ColumnSpan="2">
            <TextBlock Text="{Binding TotalCount, StringFormat='{}Всего записей:{0}'}"/>
            <TextBlock Text="{Binding FilteredCount, StringFormat='{} Показано: {0}'}"/>
        </WrapPanel>
    </Grid>
</Page>
